@model CrearFacturaClienteViewModel
@{
    //Titulo
    ViewBag.Title = "Registrar factura cliente";
    //Clase body personalizado
    ViewBag.BodyClass = "body-background-gray";
}
<!--Formulario-->

@using (Ajax.BeginForm("Crear", "FacturaCliente", new { Area = "Produccion" },
                                                    new AjaxOptions
                                                    {
                                                        HttpMethod = "POST",
                                                        OnBegin = "registrarFacturaCliente.OnBeginFormCrearFacturaCliente",
                                                        OnComplete = "registrarFacturaCliente.OnCompleteCrearFacturaCliente"
                                                    }, new { @class = "", role = "form", @id = "FormularioFacturaCliente" }))
{
    @Html.AntiForgeryToken()
    <div class="clearfix"></div>
    @Html.ValidationMessage("Error", new { @class = "text-danger" })
    @Html.ValidationMessage("Success", new { @class = "text-success" })
    @Html.ValidationSummary(false, "", new { @class = "alert alert-danger small col-md-12" })

    <div class="x_panel">
        <div class="x_title">
            <h2>@ViewBag.Title</h2>
            <ul class="nav navbar-right panel_toolbox text-right">
                <li>
                    <a class="collapse-link"><i class="fa fa-chevron-down"></i></a>
                </li>
            </ul>
            <div class="clearfix"></div>
        </div>
        <div class="x_content">

            <div class="row">
                <div class="col-md-6">
                    @Html.LabelFor(m => m.EmpresaId, new { @class = "control-label" })
                    @Html.DropDownListFor(m => m.EmpresaId, Model.ListaEmpresas, "Seleccione", new
                       {
                           @Value = "1",
                           @class = "form-control selectpicker",
                           data_live_search = "true",
                           onchange = "registrarFacturaCliente.OnchangeEmpresa(this," + "'" + Url.Action("ListarOpcionesPorEmpresa", "EmpresaCliente", new { Area = "Gestion" }) + "'" + ")"
                       })
                    @Html.ValidationMessageFor(m => m.EmpresaId, "", new { @class = "text-danger" })
                </div>

                <div class="col-md-6">
                    @Html.LabelFor(m => m.ClienteId, new { @class = "control-label" })
                    @Html.DropDownListFor(m => m.ClienteId, Model.ListaClientes, "Seleccione", new
                       {
                           @class = "form-control selectpicker",
                           data_live_search = "true",
                           onchange = "registrarFacturaCliente.OnchangeCliente(this," + "'" + Url.Action("ListaOpcionesPorCliente", "ClienteProducto", new { Area = "Gestion" }) + "'" + ")"
                       })
                    @Html.ValidationMessageFor(m => m.ClienteId, "", new { @class = "text-danger" })
                </div>

                <div id="Compromiso_Agencia_Informe_Entrevista">
                    <div class="col-md-6">
                        @Html.LabelFor(m => m.ProductoId, new { @class = "control-label" })
                        @Html.DropDownListFor(m => m.ProductoId, Model.ListaProductos, "Seleccione", new
        {
            @class = "form-control selectpicker",
            data_live_search = "true",
            onchange = "registrarFacturaCliente.OnchangeProducto(this," + "'" + Url.Action("ListaOpcionesPorProducto", "OrdenTrabajo", new { Area = "Trafico" }) + "'" + ")"
        })
                        @Html.ValidationMessageFor(m => m.ProductoId, "", new { @class = "text-danger" })
                    </div>
                    <div class="col-md-6">
                        @Html.LabelFor(m => m.OrdenTrabajoId, new { @class = "control-label" })
                        @Html.DropDownListFor(m => m.OrdenTrabajoId, Model.ListaOrdenTrabajo, "Seleccione", new
        {
            @class = "form-control selectpicker",
            data_live_search = "true",
            onchange = "registrarFacturaCliente.OnchangeOrdenTrabajo(this," + "'" + Url.Action("ListarOpcionesPorOrdenTrabajo", "Presupuesto", new { Area = "Produccion" }) + "'" + ")"
        })
                        @Html.ValidationMessageFor(m => m.OrdenTrabajoId, "", new { @class = "text-danger" })
                    </div>
                    <div class="col-md-6">
                        @Html.LabelFor(m => m.PresupuestoId, new { @class = "control-label col-md-8 padding-0 label-text-aling-left" })
                        <div class="col-md-12 padding-left-0">
                            <div class="form-group col-md-10 padding-left-0 padding-right-0">
                                @Html.DropDownListFor(m => m.PresupuestoId, Model.ListaPresupuesto, "Seleccione", new
                {
                    @class = "form-control selectpicker",
                    data_live_search = "true",
                    onchange = "registrarFacturaCliente.OnchengePresupuesto(this)"
                })
                                @Html.ValidationMessageFor(m => m.PresupuestoId, "", new { @class = "text-danger" })
                            </div>
                            @*<div class="col-md-2 hidden" id="caja-historico-factura-cliente">
                    <div class="col-md-1 padding-left-1 padding-right-0">
                        <a href="#" type="button" onclick="registrarFacturaCliente.VerHistoricoFacturaCliente()" data-size="lg" class="btn btn-produccion btn-md" data-toggle="modal" data-target="#" data-execute-onload="OnLoadHistoricoVigenciaPresupuesto" title="Ver Historico">
                            <span class="glyphicon glyphicon-level-up" aria-hidden="true"></span>
                        </a>
                    </div>
                </div>*@
                        </div>
                    </div>
                    <div class="col-md-6" id="valor-total-presupuesto">
                        <label class="control-label">Valor total presupuesto (Total costo externo) ($)</label>
                        <input class="form-control text-center" id="valor-presupuesto" readonly />
                    </div>
                    <div class="col-md-6" id="valor-pendiente-facturar">
                        <label class="control-label">Valor pendiente por facturar ($)</label>
                        <input class="form-control text-center" id="valor-pendiente" readonly />
                    </div>
                    <div class="col-md-6">
                        @Html.LabelFor(m => m.FechaFactura, new { @class = "control-label" })
                        @Html.TextBoxFor(m => m.FechaFactura, new { @class = "form-control datepicker" })
                        @Html.ValidationMessageFor(m => m.FechaFactura, "", new { @class = "text-danger" })
                    </div>
                    <div class="col-md-6">
                        @Html.LabelFor(m => m.NumeroFactura, new { @class = "control-label" })
                        @Html.TextBoxFor(m => m.NumeroFactura, new { @class = "form-control" })
                        @Html.ValidationMessageFor(m => m.NumeroFactura, "", new { @class = "text-danger" })
                    </div>
                    <div class="col-md-6">
                        @Html.LabelFor(m => m.ValorFacturaSinIva, new { @class = "control-label" })
                        @Html.TextBoxFor(m => m.ValorFacturaSinIva, new { @class = "form-control", @onkeyup = "registrarFacturaCliente.ValidarValorFactura(this)", data_format_price = "" })
                        @Html.ValidationMessageFor(m => m.ValorFacturaSinIva, "", new { @class = "text-danger" })
                    </div>
                    <div class="form-group col-md-6">
                        @Html.LabelFor(m => m.ImpuestoId, new { @class = "control-label" })
                        @Html.DropDownListFor(m => m.ImpuestoId, Model.ListaImpuestos, "Seleccione", new
        {
            @class = "form-control selectpicker",
            data_live_search = "true",
            onchange = "registrarFacturaCliente.OnChangeImpuesto(this, '" + Url.Action("ConsultarPorcentajePorId", "Impuesto", new { Area = "Parametrizacion" }) + "');"
        })
                        @Html.ValidationMessageFor(m => m.ImpuestoId, "", new { @class = "text-danger" })
                    </div>
                    <div class="col-md-6">
                        @Html.LabelFor(m => m.ValorIvaFactura, new { @class = "control-label" })
                        @Html.TextBoxFor(m => m.ValorIvaFactura, new { @class = "form-control", data_format_price = "" })
                        @Html.ValidationMessageFor(m => m.ValorIvaFactura, "", new { @class = "text-danger" })
                    </div>
                    <br>
                    <div class="clearfix"></div>
                    <hr />
                    <div class="col-md-12">
                        <button type="button" onclick="registrarFacturaCliente.AdicionarPresupuesto()" class="btn btn-secondary">
                            <span class="glyphicon glyphicon-plus">Adicionar</span>
                        </button>
                    </div>
                    <br>
                    <br>
                    <div class="form-group col-md-6">
                        @Html.LabelFor(m => m.Archivo, new { @class = "control-label" })
                        @Html.TextBoxFor(m => m.Archivo, new { @class = "form-control", type = "file", onchange = "UploadFile(this)" })
                        <div id="content-foto" class="col-md-12" hide>
                            <img src="#" alt="Foto" class="img-responsive img-center" />
                        </div>
                        @Html.ValidationMessageFor(m => m.Archivo, "", new { @class = "text-danger" })
                    </div>
                    <br>
                    <div class="clearfix"></div>
                    <table id="tabla-datos-factura" class="table table-striped table-bordered compact text-center hidden" cellpadding="0" width="100%">
                        <thead>
                            <tr>
                                <th>OT</th>
                                <th>Producto</th>
                                <th>#PPTO</th>
                                <th>Total presupuesto</th>
                                <th>Pendiente por facturar</th>
                                <th>Número de factura</th>
                                <th>Fecha de factura</th>
                                <th>Valor factura sin impuestos</th>
                                <th>Valor impuestos</th>
                                <th>Valor total</th>
                                <th>Eliminar</th>
                            </tr>
                        </thead>
                        <tfoot>
                            <tr>
                                <th colspan="3" style="text-align:right">Total:</th>
                                <th style="text-align: center"></th>
                                <th style="text-align: center"></th>
                                <th></th>
                                <th></th>
                                <th style="text-align: center"></th>
                                <th style="text-align: center"></th>
                                <th style="text-align: center"></th>
                                <th></th>
                            </tr>
                        </tfoot>
                    </table>
                </div>

            </div>
        </div>
    </div>

    <div class="text-right">
        @if (Sesion.HasPermission("PRO-FACTURA_CLIENTE_CREAR"))
        {
            <button type="submit" class="btn btn-secondary" value="Guardar">Guardar</button>
        }
        <button type="button" class="btn btn-warning" onclick="registrarFacturaCliente.FacturaCerrar()">Cerrar</button>
    </div>
}
@Styles.Render("~/bundles/dataTables.css")
@section Scripts{
    @Scripts.Render("~/bundles/dataTables.js")
}

    <script type="text/javascript">
        var URL_UPLOAD_FOTO = "@Url.Action("UploadArchivoCrear", "FacturaCliente", new { area = "Produccion" })";
        
    </script>